#'Restore_Ex_dividend
#'
#'還原除權息 2005-2016
#'資料 data tw50 共50隻
#'
#'繼承:TWSEEx_dividend2
#'
#'繼承:readTWSEEx_dividend
#'
#'前身:JAVA_getTwseData3
#disk location
Upath<-paste0("D:/")
#file location
BD_dir_path<-paste0(Upath,"data/new/tw50/")
BD_dir<-dir(BD_dir_path,"csv$")
for (i in 1:length(BD_dir)) {
#read file############################################################################################BD
getStockNumBD_path<-paste0(BD_dir_path,BD_dir[i])###############################################choice read file
getStockNumBD<-read.csv(getStockNumBD_path,fileEncoding="UTF-8",stringsAsFactors = FALSE)#<-UTF-8
colnames(getStockNumBD)
getStockNumBD<-filter(getStockNumBD,getStockNumBD$Year>=2005)
getStockNumBD<-mutate(getStockNumBD,"Date"=as.Date(paste(getStockNumBD$Year,getStockNumBD$Month,getStockNumBD$Day,sep="-")))
getStockNumBD2<-select(getStockNumBD,c(ncol(getStockNumBD),6:(ncol(getStockNumBD)-1)))
# colnames(getStockNumBD2)
# [1] "Date"   "vol_S"  "vol_P"  "P_S"    "P_H"    "P_L"    "P_E"    "P_D2"   "exc"    "NP_D2D"
assign(paste("ReED_BD",substr(BD_dir[i],1,4),sep="."),getStockNumBD2)
# #file location############################################################################################ED
ED_path<-paste0(Upath,"EXdata/Ex_dividend/getStockNumED/TW.",substr(BD_dir[i],1,4),".csv")
# assign(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."),read.csv(ED_path,stringsAsFactors = FALSE))
#
# ED<-get(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."))
ED<-read.csv(ED_path,stringsAsFactors = FALSE)
for (k in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
if(is.na(ED[k,j])|is.null(ED[k,j])|ED[k,j]==""||ED[k,j]=="<NA>"){
0->ED[k,j]
}
}
}
getData<-NULL
for (k in 1:nrow(ED)) {
if ((ED$dividend_C_Earnings+ED$dividend_C_Law)[k]>0) {
getData<-rbind(getData,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][3])
,sep="-")
))
,
"C",
(ED$dividend_C_Earnings+ED$dividend_C_Law)[k]))
}
if (((ED$dividend_S_Earnings+ED$dividend_S_Law)[k]/10>0)) {
getData<-rbind(getData,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][3])
,sep="-")
))
,
"S",
(ED$dividend_S_Earnings+ED$dividend_S_Law)[k]))
}
}
assign(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."),getData)
getDataC<-NULL
getDataS<-NULL
for (k in 1:nrow(ED)) {
if ((ED$dividend_C_Earnings+ED$dividend_C_Law)[k]>0) {
getDataC<-rbind(getDataC,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][3])
,sep="-")
))
,
"C",
(ED$dividend_C_Earnings+ED$dividend_C_Law)[k]))
}
if (((ED$dividend_S_Earnings+ED$dividend_S_Law)[k]/10>0)) {
getDataS<-rbind(getDataS,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][3])
,sep="-")
))
,
"S",
(ED$dividend_S_Earnings+ED$dividend_S_Law)[k]))
}
}
assign(paste("ReED_ED_C",substr(BD_dir[i],1,4),sep="."),getDataC)
assign(paste("ReED_ED_S",substr(BD_dir[i],1,4),sep="."),getDataS)
}
y<-get(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."))
yc<-get(paste("ReED_ED_C",substr(BD_dir[i],1,4),sep="."))
ys<-get(paste("ReED_ED_S",substr(BD_dir[i],1,4),sep="."))
EDxtsC<-xts(as.matrix(yc[,-1]),
as.Date(yc[,1]),
#as.POSIXct(fr[,1], tz=Sys.getenv("TZ")),
src='myData',updated=Sys.time())
EDxtsS<-xts(as.matrix(ys[,-1]),
as.Date(ys[,1]),
#as.POSIXct(fr[,1], tz=Sys.getenv("TZ")),
src='myData',updated=Sys.time())
EDxts<-cbind(EDxtsS,EDxtsC)
for (m in 1:nrow(EDxts)) {
for (n in 1:ncol(EDxts)) {
if (is.na(EDxts[m,n])) {
0->EDxts[m,n]
}
}
}
x<-get(paste("ReED_BD",substr(BD_dir[i],1,4),sep="."))
colnames(x)<-c("Date","vol_S","vol_P","Open","High","Low","Close","P_D2","exc","NP_D2D")
BDxts<-xts(as.matrix(x[,-1]),
as.Date(x[,1]),
#as.POSIXct(fr[,1], tz=Sys.getenv("TZ")),
src='myData',updated=Sys.time())
for(r in nrow(EDxts):1){#除權息
if(r>1){
assign(paste0("ReED_BD",r),(as.numeric(BDxts[paste0(time(EDxts[r-1,]),"/",time(EDxts[r,])-1)]$Close)-as.numeric(EDxts[r,4]))/(1+as.numeric(EDxts[r,2])))
}else if(r==1){
assign(paste0("ReED_BD",r),(as.numeric(BDxts[paste0("2005-01-01","/",time(EDxts[r,])-1)]$Close)-as.numeric(EDxts[r,4]))/(1+as.numeric(EDxts[r,2])))
}
if(r<nrow(EDxts)){
for (s in (r+1):nrow(EDxts)) {
assign(paste0("ReED_BD",r),(get(paste0("ReED_BD",r))-as.numeric(EDxts[s,4]))/(1+as.numeric(EDxts[s,2])))
}
}
}
ls(pattern = "^ReED_BD")
ReED_BD1
r
BDxts[paste0("2005-01-01","/",time(EDxts[r,])-1)]$Close
head(BDxts[paste0("2005-01-01","/",time(EDxts[r,])-1)]$Close)
EDxts
28.9-1.5-1-1.5-1.29985-1.2
2/3
(22.40015-1.5)/1.2
(17.41679-0.5)/1.5
(11.27786-0.99988)/1.99988
(5.139298-1.78802)/1.19866
(2.795854-1.49922)/1.49974
(0.8645725-0.99972)/1.99972
getSymbols("AAPL")
AAPL
1.5+1.2+1.3+1+1.5+1.5+0.5+1+1.8+1.5+1
(28.9-1)/2
(28.9-0.99972)/0.99972
(27.90809-1.49922)/1.49974
(28.9-0.99972)/1.99972
(13.95209-1.49922)/1.49974
(8.303353-1.78802)/1.19866
(5.435514-0.99988)/1.99988
(2.21795-0.5)/1.5
(1.1453-1.5)/1.2
(-0.2955833-1.2-1.29985-1.5-1-1.5)
BDxts
head(BDxts)
tail(BDxts)
nrow9BDxts)
nrow(BDxts)
BDxts[2764]
time(BDxts[2764]-4)
time(BDxts[2764])-3
time(BDxts[2764])-4
BDxts<-BDxts["2005-01-01/2016-02-29"]
BDxts[2764]
nrow(BDxts)
tail(BDxts)
# merge(yc, ys, by = "Date")
x <- cbind(c("Tom", "Joe", "Vicky","ANNIE"), c(27, 29, 28,50))
y <- cbind(c("Tom", "Joe", "Vicky","ken"), c(178, 186, 168,70))
colnames(x) <- c("name", "age")
colnames(y) <- c("name", "tall")
x
merge(x, y, by = "name")
merge(x, y, by = "name", all = T)
merge(x, y, by = "name", all.x = T)
BDxts
x <- cbind(c("2009-06-23","2009-06-24","2009-06-25","2009-06-26"), c(27, 29, 28,50))
y <- cbind(c("2009-06-23","2009-06-24","2009-06-25","2009-06-24"), c(178, 186, 168,70))
colnames(x) <- c("name", "age")
colnames(y) <- c("name", "tall")
x[,2]
as.xts(x[,2],x[,1])
x <- cbind(as.Date("2009-06-23","2009-06-24","2009-06-25","2009-06-26"), c(27, 29, 28,50))
y <- cbind(as.Date("2009-06-23","2009-06-24","2009-06-25","2009-06-24"), c(178, 186, 168,70))
colnames(x) <- c("name", "age")
colnames(y) <- c("name", "tall")
as.xts(x[,2],x[,1])
x
as.Date("2009-06-23","2009-06-24","2009-06-25","2009-06-26")
x <- cbind(as.Date(2009-06-23,2009-06-24,2009-06-25,2009-06-26), c(27, 29, 28,50))
x
x <- cbind(as.Date(2009-06-23,2009-06-24,2009-06-25,2009-06-26), c(27, 29, 28,50))
y <- cbind(as.Date(2009-06-23,2009-06-24,2009-06-25,2009-06-22), c(178, 186, 168,70))
as.xts(x[,2],x[,1])
x
xts(x[,2],x[,1])
x[,2]
x[,1]
x[,1]
xts(x[,2],as.Date(x[,1]))
x1<-xts(x[,2],as.Date(x[,1]))
y1<-xts(y[,2],as.Date(y[,1]))
cbind(x1,y1)
x <- cbind(as.Date(2009-06-23,2009-06-24,2009-06-25,2009-06-26), c(27, 29, 28,50))
x
x1<-xts(x[,2],as.Date(x[,1]))
x1
Sys.Date()
as.numeric(Sys.Date())
x <- cbind(as.Date(16900,16901,16902,16903), c(27, 29, 28,50))
y <- cbind(as.Date(16900,16901,16902,16909), c(178, 186, 168,70))
x1<-xts(x[,2],as.Date(x[,1]))
y1<-xts(y[,2],as.Date(y[,1]))
cbind(x1,y1)
#'Restore_Ex_dividend
#'
#'還原除權息 2005-2016
#'資料 data tw50 共50隻
#'
#'繼承:TWSEEx_dividend2
#'
#'繼承:readTWSEEx_dividend
#'
#'前身:JAVA_getTwseData3
#disk location
Upath<-paste0("D:/")
#file location
BD_dir_path<-paste0(Upath,"data/new/tw50/")
BD_dir<-dir(BD_dir_path,"csv$")
for (i in 1:length(BD_dir)) {
#read file############################################################################################BD
getStockNumBD_path<-paste0(BD_dir_path,BD_dir[i])###############################################choice read file
getStockNumBD<-read.csv(getStockNumBD_path,fileEncoding="UTF-8",stringsAsFactors = FALSE)#<-UTF-8
colnames(getStockNumBD)
getStockNumBD<-filter(getStockNumBD,getStockNumBD$Year>=2005)
getStockNumBD<-mutate(getStockNumBD,"Date"=as.Date(paste(getStockNumBD$Year,getStockNumBD$Month,getStockNumBD$Day,sep="-")))
getStockNumBD2<-select(getStockNumBD,c(ncol(getStockNumBD),6:(ncol(getStockNumBD)-1)))
# colnames(getStockNumBD2)
# [1] "Date"   "vol_S"  "vol_P"  "P_S"    "P_H"    "P_L"    "P_E"    "P_D2"   "exc"    "NP_D2D"
assign(paste("ReED_BD",substr(BD_dir[i],1,4),sep="."),getStockNumBD2)
# #file location############################################################################################ED
ED_path<-paste0(Upath,"EXdata/Ex_dividend/getStockNumED/TW.",substr(BD_dir[i],1,4),".csv")
# assign(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."),read.csv(ED_path,stringsAsFactors = FALSE))
#
# ED<-get(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."))
ED<-read.csv(ED_path,stringsAsFactors = FALSE)
for (k in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
if(is.na(ED[k,j])|is.null(ED[k,j])|ED[k,j]==""||ED[k,j]=="<NA>"){
0->ED[k,j]
}
}
}
getData<-NULL
for (k in 1:nrow(ED)) {
if ((ED$dividend_C_Earnings+ED$dividend_C_Law)[k]>0) {
getData<-rbind(getData,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][3])
,sep="-")
))
,
"C",
(ED$dividend_C_Earnings+ED$dividend_C_Law)[k]))
}
if (((ED$dividend_S_Earnings+ED$dividend_S_Law)[k]/10>0)) {
getData<-rbind(getData,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][3])
,sep="-")
))
,
"S",
(ED$dividend_S_Earnings+ED$dividend_S_Law)[k]))
}
}
assign(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."),getData)
getDataC<-NULL
getDataS<-NULL
for (k in 1:nrow(ED)) {
if ((ED$dividend_C_Earnings+ED$dividend_C_Law)[k]>0) {
getDataC<-rbind(getDataC,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][3])
,sep="-")
))
,
"C",
(ED$dividend_C_Earnings+ED$dividend_C_Law)[k]))
}
if (((ED$dividend_S_Earnings+ED$dividend_S_Law)[k]/10>0)) {
getDataS<-rbind(getDataS,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][3])
,sep="-")
))
,
"S",
(ED$dividend_S_Earnings+ED$dividend_S_Law)[k]))
}
}
assign(paste("ReED_ED_C",substr(BD_dir[i],1,4),sep="."),getDataC)
assign(paste("ReED_ED_S",substr(BD_dir[i],1,4),sep="."),getDataS)
}
y<-get(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."))
yc<-get(paste("ReED_ED_C",substr(BD_dir[i],1,4),sep="."))
ys<-get(paste("ReED_ED_S",substr(BD_dir[i],1,4),sep="."))
EDxtsC<-xts(as.matrix(yc[,-1]),
as.Date(yc[,1]),
#as.POSIXct(fr[,1], tz=Sys.getenv("TZ")),
src='myData',updated=Sys.time())
EDxtsS<-xts(as.matrix(ys[,-1]),
as.Date(ys[,1]),
#as.POSIXct(fr[,1], tz=Sys.getenv("TZ")),
src='myData',updated=Sys.time())
# merge(yc, ys, by = "Date")
EDxts<-cbind(EDxtsS,EDxtsC)
for (m in 1:nrow(EDxts)) {
for (n in 1:ncol(EDxts)) {
if (is.na(EDxts[m,n])) {
0->EDxts[m,n]
}
}
}
as.Date(ys[,1])
as.Date(yc[,1])
dates1 <- c("02/27/92", "02/27/92", "01/14/92", "02/28/92", "02/01/92")
as.Date(dates1, "%m/%d/%y")
dates <- c("02/01/92", "02/27/92", "01/14/92", "02/28/92", "02/01/92")
as.Date(dates, "%m/%d/%y")
x <- cbind(as.Date(dates1, "%m/%d/%y"), c(27, 29, 28,50))
y <- cbind(as.Date(dates, "%m/%d/%y"), c(178, 186, 168,70))
x
as.Date(dates1, "%m/%d/%y")
x1<-xts(x[,2],as.Date(x[,1]))
y1<-xts(y[,2],as.Date(y[,1]))
x1
y1<-xts(y[,2],as.Date(y[,1]))
y1
cbind(x1,y1)
dates <- c("02/03/92", "02/27/92", "01/14/92", "02/28/92", "02/01/92")
as.Date(dates, "%m/%d/%y")
x <- cbind(as.Date(dates1, "%m/%d/%y"), c(27, 29, 28,50))
y <- cbind(as.Date(dates, "%m/%d/%y"), c(178, 186, 168,70))
x1<-xts(x[,2],as.Date(x[,1]))
y1<-xts(y[,2],as.Date(y[,1]))
cbind(x1,y1)
x <- cbind(as.Date(dates1, "%m/%d/%y"), c(27, 29, 28,50))
dates1 <- c("02/27/92", "02/27/92", "01/14/92", "02/28/92", "02/01/92")
as.Date(dates1, "%m/%d/%y")
dates <- c("02/03/92", "02/27/92", "01/14/92", "02/28/92", "02/01/92")
as.Date(dates, "%m/%d/%y")
x <- cbind(as.Date(dates1, "%m/%d/%y"), c(27, 29, 28,50))
y <- cbind(as.Date(dates, "%m/%d/%y"), c(178, 186, 168,70))
x1<-xts(x[,2],as.Date(x[,1]))
y1<-xts(y[,2],as.Date(y[,1]))
cbind(x1,y1)
dates1 <- c("02/27/92", "02/27/92", "01/14/92", "02/28/92")
as.Date(dates1, "%m/%d/%y")
dates <- c("02/03/92", "02/27/92", "01/14/92", "02/28/92")
as.Date(dates, "%m/%d/%y")
x <- cbind(as.Date(dates1, "%m/%d/%y"), c(27, 29, 28,50))
y <- cbind(as.Date(dates, "%m/%d/%y"), c(178, 186, 168,70))
x1<-xts(x[,2],as.Date(x[,1]))
y1<-xts(y[,2],as.Date(y[,1]))
cbind(x1,y1)
