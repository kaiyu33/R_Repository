ED_path<-paste0(ED_Dir_path,ED_dir[1])
ED<-read.csv(ED_path,file = new_path00)
ED<-read.csv(ED_path)
ED
nrow(ED)
ncol(ED)
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
ED[i,j]<-ifelse(is.na(ED[i,j]),0,)
}
}
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
}
}
ED
ED[i,j]
i
j
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
# ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
if(is.na(ED[i,j])){
assign(ED[i,j],0)
}
}
}
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
# ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
if(is.na(ED[i,j])){
# assign(ED[i,j],0)
replace(ED[i,j],0)
}
}
}
as.data.frame(ED,is.na=0)
grep(ED)<-0
grep(ED,0)
ED
grep(is.na(ED),0)
ED
is.na(ED)
grepl(is.na(ED),0)
gsub(is.na(ED),0)
grep(is.na(ED))
gsub(is.na(ED),x=0)
gsub(is.na(ED),0,ED)
ED
txt <- c("arm","foot","lefroo", "bafoobar")
if(length(i <- grep("foo", txt)))
cat("'foo' appears at least once in\n\t", txt, "\n")
ED[1,]
grep("foo"
)
txt <- c("arm","foot","lefroo", "bafoobar")
grep("foo", txt)
length(i <- grep("foo", txt))
grep("[a-z]", letters)
cat("'foo' appears at least once in\n", txt, "\n")
ED[1,i<-grep(is.na(ED[1,]),ED[1,])}
if(ED[1,i<-grep(is.na(ED[1,]),ED[1,])})
ED[1,]
if(ED[1,i<-grep(is.na(ED[1,]),ED[1,]))])
ED[1,]
ED
if(ED[7,i<-grep(is.na(ED[7,]),ED[7,]))])
if(ED[7,i<-grep(is.na(ED[7,]),ED[7,])])
ED[1,]
txt <- c("arm","foot","lefroo", "bafoobar")
if(length(i <- grep("foo", txt)))
cat("'foo' appears at least once in\n\t", txt, "\n")
i # 2 and 4
txt[i]
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
# ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
if(is.na(ED[i,j])){
# assign(ED[i,j],0)
# replace(ED[i,j],0)
0->ED[i,j]
}
}
}
ED[i,j]
ED
ED[,9]
ED[5,9]
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
# ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
if(is.na(ED[i,j])|is.null(ED[i,j])){
# assign(ED[i,j],0)
# replace(ED[i,j],0)
0->ED[i,j]
}
}
}
ED
View(TW.1101)
TW.1101[5,7]
TW.1101[5,8]
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
# ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
if(is.na(ED[i,j])|is.null(ED[i,j])|ED[i,j]==""){
# assign(ED[i,j],0)
# replace(ED[i,j],0)
0->ED[i,j]
}
}
}
ED
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
# ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
if(is.na(ED[i,j])|is.null(ED[i,j])|ED[i,j]==""||ED[i,j]=="<NA>"){
# assign(ED[i,j],0)
# replace(ED[i,j],0)
0->ED[i,j]
}
}
}
ED
TW.1101[5,9]
is.na(TW.1101[5,9])
nrow(ED)
ncol(ED)
warnings()
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
# ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
if(is.na(ED[i,j])|is.null(ED[i,j])|ED[i,j]==""||ED[i,j]=="<NA>"){
# assign(ED[i,j],0)
# replace(ED[i,j],0)
"0"->ED[i,j]
}
}
}
ED
ED[5,9]
Upath<-paste0("F:/")
ED_Dir_path<-paste0(Upath,"EXdata/Ex_dividend/getStockNumED/")
ED_dir<-dir(ED_Dir_path)
ED_path<-paste0(ED_Dir_path,ED_dir[1])
ED<-read.csv(ED_path,stringsAsFactors = FALSE)
for (i in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
# ED[i,j]<-ifelse(is.na(ED[i,j]),0,break)
if(is.na(ED[i,j])|is.null(ED[i,j])|ED[i,j]==""||ED[i,j]=="<NA>"){
# assign(ED[i,j],0)
# replace(ED[i,j],0)
"0"->ED[i,j]
}
}
}
ED
#'Restore_Ex_dividend
#'
#'還原除權息 2005-2016
#'資料 data tw50 共50隻
#'
#'繼承:TWSEEx_dividend2
#'
#'繼承:readTWSEEx_dividend
#'
#'前身:JAVA_getTwseData3
#disk location
Upath<-paste0("F:/")
#file location
BD_dir_path<-paste0(Upath,"data/new/tw50/")
BD_dir<-dir(BD_dir_path,"csv$")
for (i in 1:length(BD_dir)) {
#read file############################################################################################BD
getStockNumBD_path<-paste0(BD_dir_path,BD_dir[i])###############################################choice read file
getStockNumBD<-read.csv(getStockNumBD_path,fileEncoding="UTF-8",stringsAsFactors = FALSE)#<-UTF-8
colnames(getStockNumBD)
getStockNumBD<-filter(getStockNumBD,getStockNumBD$Year>=2005)
getStockNumBD<-mutate(getStockNumBD,"Date"=as.Date(paste(getStockNumBD$Year,getStockNumBD$Month,getStockNumBD$Day,sep="-")))
getStockNumBD2<-select(getStockNumBD,c(ncol(getStockNumBD),6:(ncol(getStockNumBD)-1)))
# colnames(getStockNumBD2)
# [1] "Date"   "vol_S"  "vol_P"  "P_S"    "P_H"    "P_L"    "P_E"    "P_D2"   "exc"    "NP_D2D"
assign(paste("ReED_BD",substr(BD_dir[i],1,4),sep="."),getStockNumBD2)
# #file location############################################################################################ED
ED_path<-paste0(Upath,"EXdata/Ex_dividend/getStockNumED/TW.",substr(BD_dir[i],1,4),".csv")
# assign(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."),read.csv(ED_path,stringsAsFactors = FALSE))
#
# ED<-get(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."))
ED<-read.csv(ED_path,stringsAsFactors = FALSE)
for (k in 1:nrow(ED)) {
for (j in 1:ncol(ED)) {
if(is.na(ED[k,j])|is.null(ED[k,j])|ED[k,j]==""||ED[k,j]=="<NA>"){
0->ED[k,j]
}
}
}
getData<-NULL
for (k in 1:nrow(ED)) {
if ((ED$dividend_C_Earnings+ED$dividend_C_Law)[k]>0) {
getData<-rbind(getData,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][3])
,sep="-")
))
,
"C",
(ED$dividend_C_Earnings+ED$dividend_C_Law)[k]))
}
if (((ED$dividend_S_Earnings+ED$dividend_S_Law)[k]/10>0)) {
getData<-rbind(getData,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][3])
,sep="-")
))
,
"S",
(ED$dividend_S_Earnings+ED$dividend_S_Law)[k]))
}
}
assign(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."),getData)
getDataC<-NULL
getDataS<-NULL
for (k in 1:nrow(ED)) {
if ((ED$dividend_C_Earnings+ED$dividend_C_Law)[k]>0) {
getDataC<-rbind(getDataC,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_C_Date[k],"/")[[1]][3])
,sep="-")
))
,
"C",
(ED$dividend_C_Earnings+ED$dividend_C_Law)[k]))
}
if (((ED$dividend_S_Earnings+ED$dividend_S_Law)[k]/10>0)) {
getDataS<-rbind(getDataS,cbind(
as.character(as.Date(
paste(
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][1])+1911,
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][2]),
as.numeric(strsplit(ED$dividend_S_Date[k],"/")[[1]][3])
,sep="-")
))
,
"S",
(ED$dividend_S_Earnings+ED$dividend_S_Law)[k]))
}
}
assign(paste("ReED_ED_C",substr(BD_dir[i],1,4),sep="."),getDataC)
assign(paste("ReED_ED_S",substr(BD_dir[i],1,4),sep="."),getDataS)
}
y<-get(paste("ReED_ED",substr(BD_dir[i],1,4),sep="."))
yc<-get(paste("ReED_ED_C",substr(BD_dir[i],1,4),sep="."))
ys<-get(paste("ReED_ED_S",substr(BD_dir[i],1,4),sep="."))
EDxtsC<-xts(as.matrix(yc[,-1]),
as.Date(yc[,1]),
#as.POSIXct(fr[,1], tz=Sys.getenv("TZ")),
src='myData',updated=Sys.time())
EDxtsS<-xts(as.matrix(ys[,-1]),
as.Date(ys[,1]),
#as.POSIXct(fr[,1], tz=Sys.getenv("TZ")),
src='myData',updated=Sys.time())
EDxts<-cbind(EDxtsS,EDxtsC)
for (m in 1:nrow(EDxts)) {
for (n in 1:ncol(EDxts)) {
if (is.na(EDxts[m,n])) {
0->EDxts[m,n]
}
}
}
x<-get(paste("ReED_BD",substr(BD_dir[i],1,4),sep="."))
colnames(x)<-c("Date","vol_S","vol_P","Open","High","Low","Close","P_D2","exc","NP_D2D")
BDxts<-xts(as.matrix(x[,-1]),
as.Date(x[,1]),
#as.POSIXct(fr[,1], tz=Sys.getenv("TZ")),
src='myData',updated=Sys.time())
BDxts<-BDxts["2005-01-01/2016-02-29"]
BDxts
ls(pattern = "^ReED_BD")
for(r in nrow(EDxts):1){#除權息
if(r>1){
assign(paste0("ReED_BD",r),(as.numeric(BDxts[paste0(time(EDxts[r-1,]),"/",time(EDxts[r,])-1)]$Close)-as.numeric(EDxts[r,4]))/(1+as.numeric(EDxts[r,2])))
}else if(r==1){
assign(paste0("ReED_BD",r),(as.numeric(BDxts[paste0("2005-01-01","/",time(EDxts[r,])-1)]$Close)-as.numeric(EDxts[r,4]))/(1+as.numeric(EDxts[r,2])))
}
if(r<nrow(EDxts)){
for (s in (r+1):nrow(EDxts)) {
assign(paste0("ReED_BD",r),(get(paste0("ReED_BD",r))-as.numeric(EDxts[s,4]))/(1+as.numeric(EDxts[s,2])))
}
}
}
ls(pattern = "^ReED_BD")
ReED_BD9
ReED_BD1
nrow(EDxts)
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r>1){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*1+as.numeric(EDxts[r,2])+as.numeric(EDxts[r,4])
)
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*1+as.numeric(EDxts[r,2])+as.numeric(EDxts[r,4])
)
}
if(r<nrow(EDxts)){
for (s in (r+1):nrow(EDxts)) {
assign(paste0("ReED_BD",r),(
get(paste0("ReED_BD",r))*(1+as.numeric(EDxts[s,2]))+as.numeric(EDxts[s,4])
)
}
}
}
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r>1){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*1+as.numeric(EDxts[r,2])+as.numeric(EDxts[r,4])
)
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*1+as.numeric(EDxts[r,2])+as.numeric(EDxts[r,4])
)
}
if(r<nrow(EDxts)){
for (s in (r+1):nrow(EDxts)) {
assign(paste0("ReED_BD",r),(
get(paste0("ReED_BD",r))*(1+as.numeric(EDxts[s,2]))+as.numeric(EDxts[s,4])
))
}
}
}
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r>1){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*1+as.numeric(EDxts[r,2])+as.numeric(EDxts[r,4])
)
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*1+as.numeric(EDxts[r,2])+as.numeric(EDxts[r,4])
)
}
# if(r<nrow(EDxts)){
#   for (s in (r+1):nrow(EDxts)) {
#     assign(paste0("ReED_BD",r),(
#       get(paste0("ReED_BD",r))*(1+as.numeric(EDxts[s,2]))+as.numeric(EDxts[s,4])
#     ))
#   }
# }
}
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r>1){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*1+as.numeric(EDxts[r,2])+as.numeric(EDxts[r,4])
))
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*1+as.numeric(EDxts[r,2])+as.numeric(EDxts[r,4])
))
}
# if(r<nrow(EDxts)){
#   for (s in (r+1):nrow(EDxts)) {
#     assign(paste0("ReED_BD",r),(
#       get(paste0("ReED_BD",r))*(1+as.numeric(EDxts[s,2]))+as.numeric(EDxts[s,4])
#     ))
#   }
# }
}
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r>1){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}
}
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r>1){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}
if(r==1){
for (s in (r-1):1) {
assign(paste0("ReED_BD",r),(
get(paste0("ReED_BD",r))*(1+as.numeric(EDxts[s,2]))+as.numeric(EDxts[s,4])
))
}
}
}
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r<nrow(EDxts)){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}
if(r==1){
for (s in (r-1):1) {
assign(paste0("ReED_BD",r),(
get(paste0("ReED_BD",r))*(1+as.numeric(EDxts[s,2]))+as.numeric(EDxts[s,4])
))
}
}
}
ls(pattern = "^ReED_BD")
ReED_BD1
ReED_BD1r
r
r=1
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r<nrow(EDxts)){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}
if(r==1){
for (s in (r-1):1) {
assign(paste0("ReED_BD",r),(
get(paste0("ReED_BD",r))*(1+as.numeric(EDxts[s,2]))+as.numeric(EDxts[s,4])
))
}
}
}
ls(pattern = "^ReED_BD")
ReED_BD1
ReED_BD2
for(r in 1:nrow(EDxts)){#除權息 改以 以2005-01-01為基準
if(r<nrow(EDxts)){
assign(paste0("ReED_BD",r),
(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/",time(EDxts[r+1,])-1)]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}else if(r==nrow(EDxts)){
assign(paste0("ReED_BD",r),(
as.numeric(BDxts[paste0(time(EDxts[r,]),"/","2016-02-29")]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])
)
)
}
if(r>1){
for (s in (r-1):1) {
assign(paste0("ReED_BD",r),(
get(paste0("ReED_BD",r))*(1+as.numeric(EDxts[s,2]))+as.numeric(EDxts[s,4])
))
}
}
}
ls(pattern = "^ReED_BD")
ReED_BD2
ReED_BD1
ReED_BD11
assign(paste0("ReED_BD",0),(as.numeric(BDxts[paste0("2005-01-01","/",time(EDxts[r+1,])-1)]$Close)*(1+as.numeric(EDxts[r,2]))+as.numeric(EDxts[r,4])))
assign(paste0("ReED_BD",0),as.numeric(BDxts[paste0("2005-01-01","/",time(EDxts[r+1,])-1)]$Close))
assign(paste0("ReED_BD",0),as.numeric(BDxts[paste0("2005-01-01","/",time(EDxts[1,])-1)]$Close))
ls(pattern = "^ReED_BD")
ReED_BD0
ReED_BD1
EDxts
getSymbols("AAPL")
getSymbols("9904.TW")
9904.TW
`9904.TW`
View(`9904.TW`)
EDxts
BDxts
tail(BDxts)
EDxts
EDxtsC
EDxtsS
EDxts
getData
ED
